Хорошо, я добавлю указанный вами фрагмент кода в функцию отправки заказа. Этот фрагмент предполагает, что у вас есть серверный API, развернутый на `https://taxi-invictus.onrender.com/order`, который будет обрабатывать заказы и, как мы обсуждали ранее, может безопасно взаимодействовать с Telegram API, используя секретные токены, хранящиеся на сервере (например, в `.env` файле).

Вот обновленный код `index.html` с интеграцией вашего API-запроса:

```html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Стас Такси Межгород</title>

  <!-- Карты -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f8f9fa;
      -webkit-text-size-adjust: none;
      touch-action: manipulation;
      overflow: hidden;
    }

    /* === SPLASH SCREEN === */
    #splash-screen {
      position: fixed;
      top: 0;
      left: 0;
      z-index: 9999;
      background: #ffffff;
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: opacity 0.8s ease-out;
    }

    .splash-logo {
      width: 100%;
      max-width: 75%;
      height: auto;
      object-fit: cover;
      margin-bottom: 30px;
      border-radius: 14px;
      animation: float 2s ease-in-out infinite alternate;
    }

    @keyframes float {
      from { transform: translateY(0); }
      to { transform: translateY(-10px); }
    }

    .progress-container {
      width: 80%;
      max-width: 300px;
      height: 6px;
      background: #f0f0f0;
      border-radius: 3px;
      overflow: hidden;
      margin-top: 10px;
    }

    .progress-bar {
      width: 0%;
      height: 100%;
      background: #ffcc00;
      border-radius: 3px;
      transition: width 0.1s linear;
      box-shadow: 0 0 10px rgba(255, 204, 0, 0.4);
    }

    .loading-text {
      margin-top: 12px;
      color: #555;
      font-size: 15px;
      font-weight: 500;
    }

    /* === КАРТА === */
    #map {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }

    /* === ПАНЕЛЬ === */
    .panel-handle {
      width: 40px;
      height: 4px;
      background: #aaa;
      border-radius: 2px;
      margin: 8px auto 4px;
      cursor: pointer;
    }

    .panel {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: #fff;
      border-radius: 20px 20px 0 0;
      box-shadow: 0 -4px 25px rgba(0, 0, 0, 0.15);
      padding: 12px 16px 24px;
      z-index: 1000;
      max-height: 80vh;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      transition: bottom 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .panel.collapsed {
      bottom: -400px;
    }

    .panel::-webkit-scrollbar {
      display: none;
    }

    /* === ПОДСКАЗКИ АВТОЗАПОЛНЕНИЯ === */
    .suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #ddd;
      border-top: none;
      border-radius: 0 0 12px 12px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 10;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      font-size: 14px;
    }

    .suggestion-item {
      padding: 12px 14px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
    }

    .suggestion-item:hover, .suggestion-item.selected {
      background-color: #f1f5ff;
    }

    /* === ТАРИФЫ === */
    .tariffs {
      display: flex;
      overflow-x: auto;
      gap: 12px;
      padding: 8px 0 12px;
      margin-bottom: 16px;
      scrollbar-width: none;
    }

    .tariffs::-webkit-scrollbar {
      display: none;
    }

    .tariff {
      min-width: 105px;
      padding: 14px 12px;
      border: 2px solid #ddd;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      font-size: 14px;
    }

    .tariff.active {
      border-color: #007bff;
      background-color: #eef6ff;
      font-weight: 600;
    }

    .tariff .price {
      display: block;
      margin-top: 6px;
      font-weight: bold;
      color: #2c3e50;
      font-size: 15px;
    }

    /* === ФОРМА === */
    label {
      font-size: 14px;
      color: #333;
      margin-top: 12px;
      display: block;
    }

    .input-wrapper {
      position: relative;
    }

    .panel input,
    .panel select {
      width: 100%;
      padding: 13px 14px;
      margin-top: 6px;
      border-radius: 12px;
      border: 1px solid #ccc;
      font-size: 15px;
      background-color: #fafafa;
      outline: none;
    }

    .panel input:focus {
      border-color: #007bff;
      box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.2);
    }

    #orderBtn {
      margin-top: 18px;
      width: 100%;
      padding: 16px;
      background-color: #ffcc00;
      color: #000;
      border: none;
      border-radius: 14px;
      font-size: 17px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(255, 204, 0, 0.3);
      transition: background 0.2s;
    }

    #orderBtn:active {
      background-color: #e6b800;
    }

    #orderBtn:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }

    /* === МЕНЮ === */
    .menu-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      font-size: 24px;
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .menu-btn:active {
      transform: scale(0.95);
    }

    .menu {
      position: absolute;
      top: 64px;
      right: 12px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      padding: 12px;
      z-index: 2001;
      min-width: 220px;
      display: none;
    }

    .menu a {
      display: block;
      padding: 10px 14px;
      margin: 4px 0;
      text-decoration: none;
      color: #007bff;
      font-size: 15px;
      border-radius: 8px;
      transition: background 0.2s;
    }

    .menu a:hover {
      background-color: #f1f5ff;
    }

    /* === ПОДСКАЗКА РАЗВОРАЧИВАНИЯ === */
    .expand-hint {
      position: absolute;
      bottom: 10px;
      left: 0;
      right: 0;
      text-align: center;
      color: #888;
      font-size: 14px;
      pointer-events: none;
      opacity: 0.8;
    }
  </style>
</head>
<body>

  <!-- === SPLASH SCREEN === -->
  <div id="splash-screen">
    <img src="taxi.jpg" alt="Междугородние такси по всей России" class="splash-logo" onerror="this.src='https://placehold.co/600x300/ffcc00/000000?text=Стас+Такси+Межгород'; this.onerror=null;"/>
    <div class="progress-container">
      <div class="progress-bar" id="splash-progress"></div>
    </div>
    <div class="loading-text">Загружаем сервис...</div>
  </div>

  <!-- === ОСНОВНОЙ ИНТЕРФЕЙС === -->
  <button class="menu-btn" onclick="toggleMenu()">☰</button>

  <div class="menu" id="menu">
    <a href="https://t.me/TAXI_V_SVO?start=Здравствуйте%20возникли%20вопросы%20в%20приложении" target="_blank">Написать в Telegram</a>
    <a href="tel:+79085002121">Позвонить: +7 908 500-21-21</a>
    <a href="https://nomera-taxi.ru" target="_blank">Открыть сайт</a>
  </div>

  <div id="map"></div>

  <div class="panel" id="panel">
    <div class="panel-handle" onclick="togglePanel()"></div>

    <div class="tariffs" id="tariffList">
      <div class="tariff active" data-value="econom">Эконом <span class="price" id="price-econom">—</span></div>
      <div class="tariff" data-value="comfort">Комфорт <span class="price" id="price-comfort">—</span></div>
      <div class="tariff" data-value="comfort_plus">Комфорт+ <span class="price" id="price-comfort_plus">—</span></div>
      <div class="tariff" data-value="child">Детский <span class="price" id="price-child">—</span></div>
      <div class="tariff" data-value="minivan">Минивэн <span class="price" id="price-minivan">—</span></div>
      <div class="tariff" data-value="business">Бизнес <span class="price" id="price-business">—</span></div>
    </div>

    <label>Откуда:</label>
    <div class="input-wrapper">
      <input id="fromInput" placeholder="Например: Москва, Красная площадь" autocomplete="off"/>
      <div id="from-suggestions" class="suggestions" style="display: none;"></div>
    </div>

    <label>Куда:</label>
    <div class="input-wrapper">
      <input id="toInput" placeholder="Например: Санкт-Петербург, Невский проспект" autocomplete="off"/>
      <div id="to-suggestions" class="suggestions" style="display: none;"></div>
    </div>

    <label>Дата и время:</label>
    <input type="datetime-local" id="datetime" />

    <label>Оплата:</label>
    <select id="payment">
      <option value="cash">Наличные</option>
      <option value="transfer">Перевод</option>
    </select>

    <label>Телефон:</label>
    <input id="phone" placeholder="+7 (___) ___-__-__" maxlength="18"/>

    <button id="orderBtn">Заказать</button>
  </div>

  <div class="expand-hint" onclick="expandPanel()">↑ Нажмите, чтобы открыть заказ</div>

  <!-- === СКРИПТЫ === -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.min.js"></script>

  <script>
    // === АНИМАЦИЯ SPLASH SCREEN (ровно 5 секунд) ===
    const splash = document.getElementById('splash-screen');
    const progressBar = document.getElementById('splash-progress');
    
    let progress = 0;
    const interval = 50; // 50ms шаг
    const duration = 5000; // 5 секунд
    const step = interval / duration;

    const timer = setInterval(() => {
      progress += step;
      if (progress >= 1) {
        progress = 1;
        clearInterval(timer);
      }
      progressBar.style.width = (progress * 100) + '%';
    }, interval);

    setTimeout(() => {
      splash.style.opacity = '0';
      setTimeout(() => {
        splash.style.display = 'none';
        splash.remove(); // очистка памяти
      }, 800);
    }, 5000);

    // === МЕНЮ ===
    function toggleMenu() {
      const menu = document.getElementById("menu");
      menu.style.display = menu.style.display === "block" ? "none" : "block";
    }

    // === ПАНЕЛЬ (сворачивание) ===
    let isPanelExpanded = true;

    function togglePanel() {
      isPanelExpanded ? collapsePanel() : expandPanel();
    }

    function expandPanel() {
      document.getElementById('panel').classList.remove('collapsed');
      isPanelExpanded = true;
    }

    function collapsePanel() {
      document.getElementById('panel').classList.add('collapsed');
      isPanelExpanded = false;
      document.activeElement.blur();
    }

    // === АВТОЗАПОЛНЕНИЕ ===
    function setupAutocomplete(inputId, suggestionsId) {
      const input = document.getElementById(inputId);
      const suggestions = document.getElementById(suggestionsId);
      let selected = 0;

      input.addEventListener('input', async function () {
        const query = this.value.trim();
        if (query.length < 3) {
          hideSuggestions(suggestions);
          return;
        }

        try {
          const res = await fetch(
            `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&addressdetails=1&limit=5&country_codes=ru,ua,kz,bj`
          );
          const data = await res.json();

          if (data.length === 0) {
            showNoResults(suggestions);
            return;
          }

          renderSuggestions(data, suggestions, input);
        } catch (e) {
          console.error("Nominatim error", e);
        }
      });

      input.addEventListener('focus', function () {
        if (suggestions.innerHTML) suggestions.style.display = 'block';
      });

      input.addEventListener('keydown', function (e) {
        const items = suggestions.querySelectorAll('.suggestion-item');
        if (e.key === 'ArrowDown') {
          e.preventDefault();
          selected = Math.min(selected + 1, items.length - 1);
          updateSelection(items);
        } else if (e.key === 'ArrowUp') {
          e.preventDefault();
          selected = Math.max(selected - 1, 0);
          updateSelection(items);
        } else if (e.key === 'Enter') {
          e.preventDefault();
          if (items[selected]) items[selected].click();
        }
      });

      function renderSuggestions(data, container, inputField) {
        container.innerHTML = '';
        data.forEach((item, i) => {
          const div = document.createElement('div');
          div.className = `suggestion-item ${i === 0 ? 'selected' : ''}`;
          div.textContent = item.display_name;
          div.dataset.lat = item.lat;
          div.dataset.lon = item.lon;
          div.onclick = () => {
            inputField.value = item.display_name;
            hideSuggestions(container);
            buildRoute();
          };
          container.appendChild(div);
        });
        container.style.display = 'block';
        selected = 0;
      }

      function showNoResults(container) {
        container.innerHTML = '<div class="suggestion-item">Адрес не найден</div>';
        container.style.display = 'block';
      }

      function hideSuggestions(container) {
        container.style.display = 'none';
        selected = 0;
      }

      function updateSelection(items) {
        items.forEach((item, i) => {
          item.classList.toggle('selected', i === selected);
        });
      }

      document.addEventListener('click', function (e) {
        if (!input.contains(e.target) && !suggestions.contains(e.target)) {
          hideSuggestions(suggestions);
        }
      });
    }

    setupAutocomplete('fromInput', 'from-suggestions');
    setupAutocomplete('toInput', 'to-suggestions');

    // === КАРТА И МАРШРУТ ===
    const map = L.map('map').setView([55.75, 37.61], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    let control = null;
    let selectedTariff = 'econom';
    let lastDistance = 0;

    const rates = {
      econom: 35,
      comfort: 37,
      comfort_plus: 40,
      child: 39,
      minivan: 55,
      business: 50
    };

    function updateTariffPrices(km) {
      lastDistance = km;
      for (let key in rates) {
        const el = document.getElementById("price-" + key);
        if (el) el.innerText = Math.round(rates[key] * km) + " ₽";
      }
    }

    async function buildRoute() {
      const from = document.getElementById("fromInput").value.trim();
      const to = document.getElementById("toInput").value.trim();
      if (!from || !to) return;

      const fromCoords = await geocode(from);
      const toCoords = await geocode(to);

      if (!fromCoords || !toCoords) return alert("Адрес не найден");

      if (control) map.removeControl(control);

      control = L.Routing.control({
        waypoints: [L.latLng(...fromCoords), L.latLng(...toCoords)],
        createMarker: (i, wp) => L.marker(wp.latLng, { draggable: true }).on("dragend", async e => {
          const { lat, lng } = e.target.getLatLng();
          const address = await reverseGeocode(lat, lng);
          if (i === 0) document.getElementById("fromInput").value = address;
          else document.getElementById("toInput").value = address;
          buildRoute();
        })
      }).addTo(map);

      control.on("routesfound", e => {
        const km = e.routes[0].summary.totalDistance / 1000;
        updateTariffPrices(km);
      });
    }

    async function geocode(query) {
      const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`);
      const data = await res.json();
      return data[0] ? [parseFloat(data[0].lat), parseFloat(data[0].lon)] : null;
    }

    async function reverseGeocode(lat, lon) {
      const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`);
      const data = await res.json();
      return data.display_name || "";
    }

    navigator.geolocation.getCurrentPosition(async pos => {
      const { latitude, longitude } = pos.coords;
      map.setView([latitude, longitude], 14);
      const address = await reverseGeocode(latitude, longitude);
      document.getElementById("fromInput").value = address;
      buildRoute();
    }, () => console.log("Геолокация отключена"));

    document.querySelectorAll('.tariff').forEach(el => {
      el.onclick = () => {
        document.querySelectorAll('.tariff').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        selectedTariff = el.dataset.value;
      };
    });

    document.getElementById("phone").addEventListener("input", function () {
      let val = this.value.replace(/\D/g, "");
      if (val.length > 1) {
        val = "+7 (" + (val[1] ? val.substring(1, 4) : val.substring(1)) + ") " +
              (val.length > 4 ? val.substring(4, 7) : "") +
              (val.length > 7 ? "-" + val.substring(7, 9) : "") +
              (val.length > 9 ? "-" + val.substring(9, 11) : "");
      }
      this.value = val;
    });

    // Функция для отправки заказа
    async function sendOrder(orderData) {
      try {
        console.log("Отправка заказа на сервер:", orderData);
        
        const response = await fetch("https://taxi-invictus.onrender.com/order", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(orderData)
        });

        if (!response.ok) {
          const errorText = await response.text();
          console.error("Ошибка сервера:", response.status, errorText);
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();
        console.log("Ответ от сервера:", result);
        return true;
      } catch (error) {
        console.error("Ошибка отправки заказа:", error);
        return false;
      }
    }

    document.getElementById("orderBtn").addEventListener("click", async () => {
      const phone = document.getElementById("phone").value.trim();
      const from = document.getElementById("fromInput").value.trim();
      const to = document.getElementById("toInput").value.trim();
      const datetime = document.getElementById("datetime").value;
      const payment = document.getElementById("payment").value;
      const price = Math.round(rates[selectedTariff] * lastDistance);

      if (!from || !to || !datetime || phone.length < 16) {
        alert("Заполните все поля корректно");
        expandPanel();
        return;
      }
      if (lastDistance === 0) {
        alert("Постройте маршрут");
        expandPanel();
        return;
      }

      const readableDate = new Date(datetime).toLocaleString("ru-RU", {
        day: '2-digit',
        month: 'long',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });

      // Создаем объект заказа
      const orderData = {
        phone,
        from,
        to,
        datetime: readableDate,
        tariff: document.querySelector(`.tariff[data-value="${selectedTariff}"]`).textContent.split(' ')[0],
        price: price,
        payment: payment === 'cash' ? 'Наличные' : 'Перевод'
      };

      // Показываем индикатор загрузки
      const orderBtn = document.getElementById("orderBtn");
      const originalText = orderBtn.textContent;
      orderBtn.textContent = "Отправка...";
      orderBtn.disabled = true;

      try {
        // Отправляем заказ на сервер
        const sent = await sendOrder(orderData);
        
        if (sent) {
          alert(`✅ Заказ принят и отправлен!\nСтоимость: ${price} ₽\nДата: ${readableDate}`);
          
          // Сбрасываем форму
          document.getElementById("fromInput").value = "";
          document.getElementById("toInput").value = "";
          document.getElementById("datetime").value = "";
          document.getElementById("phone").value = "";
          
          if (control) {
            map.removeControl(control);
            control = null;
          }
          
          updateTariffPrices(0);
        } else {
          alert("Заказ принят, но не удалось отправить уведомление. Мы свяжемся с вами.");
        }
      } catch (error) {
        console.error("Ошибка обработки заказа:", error);
        alert("Произошла ошибка при оформлении заказа. Попробуйте позже.");
      } finally {
        orderBtn.textContent = originalText;
        orderBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
```